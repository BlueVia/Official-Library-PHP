<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>PHPSDK: MMS MO API guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="BlueviaLogo.jpg"></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">PHPSDK&#160;<span id="projectnumber">1.6</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('blv_php_mmsmo_guide.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>MMS MO API guide </h1>  </div>
</div>
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="blv_mms_mo_api_receiving_mms_messages_sec"></a>
Bluevia MMS MO API: Receiving MMS messages</h2>
<p>The Bluevia MMS API is a set of functions which allows users to receive MMS messages sent from a mobile phone. This guide represents a practical introduction to developing applications in which the user wants to provide the Bluevia MMS functionality. You can learn more about this API at Bluevia's <a href="https://bluevia.com/en/page/tech.APIs.MmsAPI" target="blank">Mms API</a> reference.</p>
<h3><a class="anchor" id="mms_mo_client_basics_sec"></a>
MMS MO client basics</h3>
<p>A MMS client represents the client side in a classic client-server schema. This object wraps up the underlying REST client side functionality needed to perform requests against a REST server.</p>
<p>Any Bluevia client performs requests and receives responses in a secure mode. Clients are authorized following the OAuth protocol. This security protocol enables users to grant third-party access to their resources without sharing their passwords. So clients store the authorization data -called security credentials- to grant access to the server. Following sections describe what security credentials we are talking about.</p>
<h3><a class="anchor" id="creating_a_mms_mo_client_sec"></a>
Creating a MMS MO client: BV_MoMms class</h3>
<p>The first step in using the MMS client is to create a <a class="el" href="class_b_v___mo_mms.html" title="Client interface for the REST binding of the Bluevia MMS MO Service.">BV_MoMms</a> object. As we mentioned earlier this object could have two different working modes: i) as a client which sends requests to a real server, or ii) as a client which sends requests and receives responses to/from a sandbox server.</p>
<h4><a class="anchor" id="mms_mo_client_features_working_modes_sec"></a>
MMS MO client features: working modes</h4>
<p>When you create the client, you can specify various working modes: </p>
<ul>
<li>
<p class="startli"><a class="el" href="class_b_v___mode.html#abc1c5fcc41548942acf01ed32d31f4f0" title="In the Live environment your application uses the real network.">BV_Mode::LIVE</a> <br/>
In the Live environment your application uses the real network, which means that you will be able to send real transactions to real Movistar, O2 and Vivo customers in the applicable country.</p>
<p class="endli"></p>
</li>
<li>
<p class="startli"><a class="el" href="class_b_v___mode.html#a8d7759e13bc0c420f06a21e219e9da76" title="In the Test environment your application uses the real network.">BV_Mode::TEST</a> <br/>
The Test mode behave exactly like the Live mode, but the API calls are free of chargue, using a credits system. You are required to have a Movistar, O2 or Vivo mobile number to get this monthly credits.</p>
<p class="endli"></p>
</li>
<li>
<a class="el" href="class_b_v___mode.html#a0bda8698e06a60ea5d2db01f4c0cd488" title="No traffic Generated.">BV_Mode::SANDBOX</a> <br/>
The Sandbox environment offers you the exact same experience as the Live environment except that no traffic is generated on the live network, meaning you can experiment and play until your heartâ€™s content. </li>
</ul>
<h4><a class="anchor" id="mms_mo_client_features_security_credentials"></a>
MMS MO client features: security credentials</h4>
<p>Bluevia uses OAuth as its authentication mechanism which enables websites and applications to access the Bluevia API's without end users disclosing their personal credentials. In order to grant access to the server any client has to be created passing the security credential as parameter in its constructor. These security credentials are managed internally and added as a HTTP header in every request sent to the server.</p>
<p>Bluevia MMS MO API uses OAuth-2-legged since user's authorization is not required to received MMSs. Then, it is not neccessary for the user to pass through the OAuth process and there is no need of an access token. Mandatory OAuth security credentials for 2-legged mode are:</p>
<ul>
<li>
<p class="startli"><b>Consumer key</b> <br/>
The string identifying the application- you obtained when you registered your application within the provisioning portal.</p>
<p class="endli"></p>
</li>
<li>
<b>Consumer Secret</b> <br/>
A secret -a string- used by the consumer to establish ownership of the consumer key. </li>
</ul>
<h4><a class="anchor" id="mms_mo_client_features_code_examples_sec"></a>
MMS MO client features: code example</h4>
<p>Find below an example about how to create a Mms client object taking into account all information previously given. This snippet shows how to access a Bluevia server using OAuth security credentials</p>
<div class="fragment"><pre class="fragment"><span class="comment">// BV_mode::LIVE indicating the client works against a real Bluevia server.</span>
<span class="keywordflow">try</span> {
        $mmsClient = <span class="keyword">new</span> <a class="code" href="class_b_v___mo_mms.html" title="Client interface for the REST binding of the Bluevia MMS MO Service.">BV_MoMms</a>(BV_mode::LIVE, <span class="stringliteral">&quot;consumer_key&quot;</span>, <span class="stringliteral">&quot;consumer_secret&quot;</span>);
} <span class="keywordflow">catch</span> (<a class="code" href="class_bluevia___exception.html" title="Base class for Exceptions.">Bluevia_Exception</a> e){
        print $e-&gt;getMessage();
}
</pre></div><h3><a class="anchor" id="receiving_mmsmessages"></a>
Receiving MMS messages</h3>
<p>Your application can receive MMS from users sent to Bluevia shortcodes including your application keyword. The parameter 'registrationId' corresponds to the shortcode of the country whose messages are being retrieved. The operation to get received messages has to be done in two steps. First you have to use the getAllMessages function to retreive the messages info, including the short number. Depending on the value of the 'attachUrl' parameter (false by default), the second step would be done in two different ways. If the parameter is true, the ids of the attachments will be retreived in order to use the getAttachment operation; otherwise the attachments would have to be obtained throught the getMessage function. The function signature is:</p>
<div class="fragment"><pre class="fragment"><span class="keyword">public</span> function getAllMessages($registrationId, $attachUrl)
</pre></div><p>The returned <a class="el" href="class_mms___message___info.html" title="Class representing the elements that will be received using the BV_MoMms_Client::getAllMessages metho...">Mms_Message_Info</a> object contains the information of the sent MMS, but the attachments.</p>
<p>For a more detailed description see the <a class="el" href="class_b_v___mo_mms___client.html#a06755c52ea189476a1ddc546ed5188cd" title="Retrieves the list of received messages.">BV_MoMms::getAllMessages</a> and <a class="el" href="class_mms___message___info.html" title="Class representing the elements that will be received using the BV_MoMms_Client::getAllMessages metho...">Mms_Message_Info</a>.</p>
<p>In order to retreive attached documents in the MMS you have to use the following functions. The '$messageId' can be obtained in the <a class="el" href="class_mms___message___info.html" title="Class representing the elements that will be received using the BV_MoMms_Client::getAllMessages metho...">Mms_Message_Info</a> object returned by the previous function. The resultant <a class="el" href="class_mms___message.html" title="Class representing the elements that will be received using the BV_MoMms_Client::getMessage method It...">Mms_Message</a> object contains the info of the Mms and a list of <a class="el" href="class_mime___content.html" title="Class representing a Mime Content (an attachment) of a received MMS.">Mime_Content</a> objects representing the attachments:</p>
<div class="fragment"><pre class="fragment"><span class="keyword">public</span> function getMessage($registrationId, $messageId)
</pre></div><p>For a more detailed description see the <a class="el" href="class_b_v___mo_mms___client.html#ac890f051dce333c342b754f0629605d4" title="Gets the content of a message with a &#39;messageId&#39; sent to the &#39;registrationId&#39;.">BV_MoMms::getMessage</a> and <a class="el" href="class_mms___message.html" title="Class representing the elements that will be received using the BV_MoMms_Client::getMessage method It...">Mms_Message</a>.</p>
<p>Using the getAttachment function you will receive the MimeContent object corresponding to he attachment identifier:</p>
<div class="fragment"><pre class="fragment"><span class="keyword">public</span> function getAttachment($registrationId, $messageId, $attachmentId) 
</pre></div><p>For a more detailed description see the <a class="el" href="class_b_v___mo_mms___client.html#ae8968565308fa78468d7fe159941869d" title="Gets the attachment with the specified id of the received message.">BV_MoMms::getAttachment</a> and <a class="el" href="class_mime___content.html" title="Class representing a Mime Content (an attachment) of a received MMS.">Mime_Content</a>.</p>
<h3><a class="anchor" id="mms_notifications_sec"></a>
Notifications</h3>
<p>Your application can create a subscription to receive MMS sent to your application. You can also unsubscribe the notification for this request.</p>
<div class="fragment"><pre class="fragment"><span class="keyword">public</span> function startNotification($phoneNumber,$endpoint,$criteria,$correlator=null)
</pre></div><p>To receive notifications of MMS sent to your applications you must provide an endpoint with the URI where notifications must be sent. Note that BlueVia only accepts HTTPS endpoints and the server certificate must be provided during the process of requesting the API key. You must also provide the destination address and the the criteria element containing the keyword you chose for your application when you requested the API key (keywords are case-insensitive) The correlator element is an identifier to correlate notifications with subscriptions. If you don't pass it the SDK will generate one for you and it will be returned by the function.</p>
<p>For a more detailed description see the <a class="el" href="class_b_v___mo_mms___client.html#af5caf0789dfea5ab8746b10d93dbf5a4" title="Receive notifications about SMS sent to your applications.">BV_MoMms::startNotification</a>.</p>
<p>If you want to unsubscribe and stop receiving notifications you should use the following method:</p>
<div class="fragment"><pre class="fragment"><span class="keyword">public</span> function stopNotification($correlator)
</pre></div><p>You must pass the $correlator parameter returned by the startNotification method.</p>
<p>For a more detailed description see the <a class="el" href="class_b_v___mo___client.html#a4adf3939e73c61ed1db3915e187cabc1" title="Unsuscribe your application, to stop recieving notifications.">BV_MoMms::stopNotification</a>.</p>
<h3><a class="anchor" id="mms_api_code_example_sec"></a>
Bluevia MMS MT API: code example</h3>
<div class="fragment"><pre class="fragment"><span class="comment">// Receiving MMSs:</span>

<span class="keywordflow">try</span> {

        <span class="comment">// 1. Create the client (you have to choose the mode and include the OAuth authorization values. No access token is needed)</span>
        $mmsMoClient = <span class="keyword">new</span> <a class="code" href="class_b_v___mo_mms.html" title="Client interface for the REST binding of the Bluevia MMS MO Service.">BV_MoMms</a>(<a class="code" href="class_b_v___mode.html#abc1c5fcc41548942acf01ed32d31f4f0" title="In the Live environment your application uses the real network.">BV_Mode::LIVE</a>, <span class="stringliteral">&quot;consumer_key&quot;</span>, <span class="stringliteral">&quot;consumer_secret&quot;</span>);

        <span class="comment">// 2. Retrieve sent MMS list:</span>
        <span class="comment">// We set the a &#39;attachUrl&#39; to false, so we will use the getMessage function instead of the getAttachment function later.</span>
        $registrationId = <span class="stringliteral">&quot;546780&quot;</span>
        $mmsList = $mmsMoClient-&gt;getAllMessages($registrationId, <span class="keyword">false</span>); 
        
        <span class="comment">// 3. For each MMS info object, retrieve </span>
        <span class="keywordflow">foreach</span> ($mmsList as $mms){
                $message = mmsMoClient-&gt;getMessage($registrationId, $mms-&gt;messageId());
        
                <span class="keywordflow">for</span> ($message-&gt;attachments as $attachment){
                        <span class="comment">//Do stuff</span>
                }
        
        }

} <span class="keywordflow">catch</span> (<a class="code" href="class_bluevia___exception.html" title="Base class for Exceptions.">Bluevia_Exception</a> $e) {
        print <span class="stringliteral">&quot;Error receiving MMS&quot;</span>. $e-&gt;getMessage();
} 
</pre></div><div class="fragment"><pre class="fragment"><span class="comment">// Notifications:</span>

<span class="keywordflow">try</span> {

        <span class="comment">// 1. Create the client (you have to choose the mode and include the OAuth authorization values. No access token is needed)</span>
        $mmsMoClient = <span class="keyword">new</span> <a class="code" href="class_b_v___mo_mms.html" title="Client interface for the REST binding of the Bluevia MMS MO Service.">BV_MoMms</a>(<a class="code" href="class_b_v___mode.html#abc1c5fcc41548942acf01ed32d31f4f0" title="In the Live environment your application uses the real network.">BV_Mode::LIVE</a>, <span class="stringliteral">&quot;consumer_key&quot;</span>, <span class="stringliteral">&quot;consumer_secret&quot;</span>);

        <span class="comment">// 2. Start recieving notifications:</span>
        $correlator = $mmsMoClient-&gt;startNotification(<span class="stringliteral">&quot;546780&quot;</span>,<span class="stringliteral">&quot;https://www.myendpoint.com/&quot;</span>,<span class="stringliteral">&quot;My_keyword&quot;</span>); 
        
        <span class="comment">// 3. Stop recieving notifications:</span>
        $mmsMoClient-&gt; stopNotification($correlator);
        print <span class="stringliteral">&quot;Stop notifications executed succesfully!&quot;</span>;

} <span class="keywordflow">catch</span> (<a class="code" href="class_bluevia___exception.html" title="Base class for Exceptions.">Bluevia_Exception</a> e) {
        print <span class="stringliteral">&quot;Error receiving Notifications &quot;</span>.$e-&gt;getMessage();
} 
</pre></div> </div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">Generated on Thu May 24 2012 09:22:37 for PHPSDK by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
