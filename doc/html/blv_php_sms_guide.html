<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Bluevia: SMS API guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Bluevia</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('blv_php_sms_guide.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>SMS API guide </h1>  </div>
</div>
<div class="contents">
<div class="textblock"><p>SMS API enables your application to send an SMS on behalf of the user, check the delivery status of a sent SMS and Receive an SMS on your application.</p>
<p>If you want to understand how SMS API works please read the <a href="https://bluevia.com/en/knowledge/APIs.API-Guides.SMS">BlueVia SMS API guide</a>, you can also get really into the details reading SMS API reference.</p>
<h2><a class="anchor" id="sms_api_client_set_up"></a>
SMS API client set up</h2>
<p>As detailed in the Programming guidelines you have to set up your <a class="el" href="class_bluevia_client.html">BlueviaClient</a> object:</p>
<div class="fragment"><pre class="fragment">application_context = array(
    <span class="stringliteral">&#39;user&#39;</span> =&gt; array(
        <span class="stringliteral">&#39;token_access&#39;</span> =&gt; $token,
        <span class="stringliteral">&#39;token_secret&#39;</span> =&gt; $token_secret,
    ),
    <span class="stringliteral">&#39;app&#39;</span> =&gt; array(
        <span class="stringliteral">&#39;consumer_key&#39;</span> =&gt; CONSUMER_KEY,
        <span class="stringliteral">&#39;consumer_secret&#39;</span> =&gt; CONSUMER_SECRET        
    )
);
$bv = <span class="keyword">new</span> <a class="code" href="class_bluevia_client.html">BlueviaClient</a>($application_context);
</pre></div><p>Once configured, you are able to get your SMS API client:</p>
<div class="fragment"><pre class="fragment"><span class="comment">// Get SMS API client</span>
$sms = $bv-&gt;getService(<span class="stringliteral">&#39;Sms&#39;</span>);  
</pre></div><h2><a class="anchor" id="sms_sending_sms_sec"></a>
Sending SMS</h2>
<p>SMS API allows your app to send messages on behalf of the users, this means that their mobile number will be the text sender and they will pay for them.</p>
<p>After set up your client, you are ready to send messages with it:</p>
<div class="fragment"><pre class="fragment"><span class="comment">// Create message to send</span>
$recipient1= <span class="stringliteral">&quot;xxxxxxxxxxxx&quot;</span>; 
$recipient2= <span class="stringliteral">&quot;xxxxxxxxxxxx&quot;</span>; 
$text = <span class="stringliteral">&quot;Hello World!&quot;</span>;
$sms-&gt;addRecipient($recipient1)
    -&gt;addRecipient($recipient2)
    -&gt;setMessage($text);

<span class="comment">// Send message</span>
<span class="keywordflow">try</span> {
$id = $sms-&gt;send();
} <span class="keywordflow">catch</span>(Exception $e) {
print <span class="stringliteral">&#39;&lt;p style=&quot;color:red&quot;&gt;</span>
<span class="stringliteral">ERROR! &#39;</span> . $e-&gt;getMessage() . <span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;
}
</pre></div><p>Take into account that the recipients numbers are required to included the international country calling code.</p>
<h2><a class="anchor" id="sms_sending_notification"></a>
Sending SMS with status notification</h2>
<p>It is possible to receive status notifications by providing BlueVia with an URI where notifications must be sent. This URI is provided during the SMS sending, including the optional parameters endpoint and correlator: </p>
<div class="fragment"><pre class="fragment"><span class="keywordflow">try</span> {
        $smsId = $sms-&gt;send(
        <span class="stringliteral">&quot;https://www.myendpoint.com&quot;</span>,
        $correlator
        );                                    
} <span class="keywordflow">catch</span>(Exception $e) {
        $this-&gt;fail($e-&gt;getMessage());
}
</pre></div><p> Note that although your are requesting delivery status notifications, you still are able to use the Location header to ask for delivery status following the polling strategy. Your application must reply with a 204 No Content HTTP status and no body.</p>
<h2><a class="anchor" id="sms_checking_delivery_status_sec"></a>
Checking the delivery status</h2>
<p>After sending an SMS you may need to know if it has been delivered. </p>
<h3><a class="anchor" id="sms_checking_delivery_status_subsec"></a>
Polling to check the delivery status</h3>
<p>This alternative is used typically for mobile or desktop applications without a backend server. After sending a SMS, you need to keep the delivery status id to ask about the delivery status of that SMS as follows: </p>
<div class="fragment"><pre class="fragment"><span class="comment">// Send SMS and keep the deliverystatus_id</span>
<span class="keywordflow">try</span> {   
    $deliverystatus_id= $sms-&gt;send();
} <span class="keywordflow">catch</span>(Exception $e) {
    print <span class="stringliteral">&#39;&lt;p style=&quot;color:red&quot;&gt; ERROR! &#39;</span> . $e-&gt;getMessage() . <span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;
}
<span class="comment">// Receive SMS status</span>
<span class="keywordflow">try</span> {
    $statuses = $sms-&gt;getDeliveryStatus($deliverystatus_id);
} <span class="keywordflow">catch</span>(Exception $e){
    print <span class="stringliteral">&#39;&lt;p style=&quot;color:red&quot;&gt; </span>
<span class="stringliteral">        ERROR on getDeliveryStatus! &#39;</span> . $e-&gt;getMessage() . <span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;
}

<span class="keywordflow">if</span> (!empty($statuses)) {
print <span class="stringliteral">&#39;&lt;p style=&quot;color:green&quot;&gt;</span>
<span class="stringliteral">SUCCESS on getDeliveryStatus! &#39;</span> . print_r($statuses, 1) . <span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;
}
</pre></div><h2><a class="anchor" id="sms_receiving_sec"></a>
Receiving SMS</h2>
<p>Your application can receive SMS from users sent to BlueVia shortcodes including your application keyword, you can grab user's messages. </p>
<h3><a class="anchor" id="sms_polling_subsec"></a>
Polling to receive SMS</h3>
<p>After set up your client, your are ready to get the messages, you have to take into account that you will need to remember the SMS keyword you defined when you requested you API key. You can check the shortcodes available at API country availability.</p>
<div class="fragment"><pre class="fragment"><span class="comment">// MX shortcode</span>
$shortcode = <span class="stringliteral">&quot;5210666&quot;</span>;
<span class="keywordflow">try</span> {
    $message = $sms-&gt;getMessages($shortcode);
    print <span class="stringliteral">&#39;&lt;p style=&quot;color:green&quot;&gt; TEST OK! getReceivedMessage ID is: &#39;</span> . print_r($message,1) . <span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;
} <span class="keywordflow">catch</span>(Exception $e) {
    print <span class="stringliteral">&#39;&lt;p style=&quot;color:red&quot;&gt; ERROR! &#39;</span> . $e-&gt;getMessage() . <span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;
}
</pre></div><p>Please note that is is just an example and you should implement an efficient polling strategy.</p>
<h2><a class="anchor" id="sms_notifications_sec"></a>
Notifications</h2>
<p>Your application can create a subscription to receive SMS sent to your application. You can also unsubscribe the notification for this request.</p>
<p>To receive notifications of SMS sent to your applications you must provide an endpoint whit the URI where notifications must be sent and a correlator element with and identifier to correlate notifications with subscriptions.</p>
<div class="fragment"><pre class="fragment">$correlator = <span class="stringliteral">&quot;corr&quot;</span>.  rand(0, 1000);
</pre></div><p> Note that BlueVia only accepts HTTPS endpoints and the server certificate must be provided during the process of requesting the API key.</p>
<p>You must also provide the list with the destination addresses and shortcode numbers.</p>
<div class="fragment"><pre class="fragment"><span class="comment">// Setup the destination number</span>
$number = <span class="stringliteral">&quot;527902135544&quot;</span>;

<span class="comment">// Set the recipient with number</span>
$sms-&gt;setRecipient($number)     
</pre></div><p> Then you can provide the criteria element containing the keyword you chose for your application when you requested the API key (keywords are case-insensitive) </p>
<div class="fragment"><pre class="fragment"><span class="comment">// Define the criteria value</span>
define(<span class="stringliteral">&#39;SMS_SPECIAL_KEYWORD&#39;</span>, <span class="stringliteral">&quot;MYKEYWORD&quot;</span>);
</pre></div><p>Finally, you can subscribe to receive the notifications that you configured </p>
<div class="fragment"><pre class="fragment"><span class="comment">// Start notifications</span>
$notif_id =  $sms-&gt;startSmsNotification(
 <span class="stringliteral">&#39;https://www.myendpoint.com/&#39;</span>,
  $correlator,
  SMS_SPECIAL_KEYWORD);
</pre></div><p>If you want to unsubscribe and stop reveiving notifications you should simply do: </p>
<div class="fragment"><pre class="fragment"><span class="comment">// Stop notifications</span>
$sms-&gt;stopSmsNotification($notif_id);
</pre></div> </div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">Generated on Tue Nov 15 2011 10:19:21 for Bluevia by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
