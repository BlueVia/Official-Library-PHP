<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Bluevia: MMS API guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Bluevia&#160;<span id="projectnumber">1.5</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('blv_php_mms_guide.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>MMS API guide </h1>  </div>
</div>
<div class="contents">
<div class="textblock"><p>MMS API enables your application to send an MMS on behalf of the user, check the delivery status of a sent MMS and Receive an MMS on your application.</p>
<p>If you want to understand how MMS API works please read the BlueVia MMS API guide, you can also get really into the details reading MMS API reference.</p>
<p>This API is really separated in two different APIS (as shown below) with diferent oauth needs </p>
<ul>
<li>
MmsMT which needs a three legged client, with the access token obtained by the user. &lt;liMSmsMO needs a two legged client. The access token is not mandatory in applications that does not need user's permissions </li>
</ul>
<h2><a class="anchor" id="mmsmt_api_client_set_up"></a>
MmsMT (Mobile Terminated)</h2>
<h3><a class="anchor" id="mmsmt_api_client_set_up"></a>
MmsMT (Mobile Terminated)</h3>
<p>As detailed in the Programming guidelines you have to set up your <a class="el" href="class_bluevia_client.html">BlueviaClient</a> object:</p>
<div class="fragment"><pre class="fragment">application_context = array(
    <span class="stringliteral">&#39;user&#39;</span> =&gt; array(
        <span class="stringliteral">&#39;token_access&#39;</span> =&gt; $token,
        <span class="stringliteral">&#39;token_secret&#39;</span> =&gt; $token_secret,
    ),
    <span class="stringliteral">&#39;app&#39;</span> =&gt; array(
        <span class="stringliteral">&#39;consumer_key&#39;</span> =&gt; CONSUMER_KEY,
        <span class="stringliteral">&#39;consumer_secret&#39;</span> =&gt; CONSUMER_SECRET        
    )
);
$bv = <span class="keyword">new</span> <a class="code" href="class_bluevia_client.html">BlueviaClient</a>($mode,$application_context);
</pre></div><p>Once configured, you are able to get your MmsMT API client:</p>
<div class="fragment"><pre class="fragment"><span class="comment">// Get MMS API client</span>
$mms = $bv -&gt; getService(<span class="stringliteral">&#39;MmsMT&#39;</span>);      
</pre></div><h3><a class="anchor" id="mmsmt_sending_mms_sec"></a>
Sending MMS</h3>
<p>MMS API allows your app to send messages on behalf of the users, this means that their mobile number will be the text sender and they will pay for them.</p>
<p>After setting up your client, you are ready to send messages with it:</p>
<div class="fragment"><pre class="fragment"><span class="comment">// Create message to send</span>
$recipient1= <span class="stringliteral">&quot;xxxxxxxxxxxx&quot;</span>; 
$recipient2= <span class="stringliteral">&quot;xxxxxxxxxxxx&quot;</span>; 
$mms-&gt;addRecipient($recipient1)
    -&gt;addRecipient($recipient2)
    -&gt;setSubject(<span class="stringliteral">&quot;subject&quot;</span>);
    -&gt;addFile(<span class="stringliteral">&quot;test.image.jpg&quot;</span>, BlueviaClient_Messaging_Mimetype::IMAGE_JPEG);    

<span class="comment">// Send message</span>
<span class="keywordflow">try</span> {
        $id = $mms-&gt;send();
} <span class="keywordflow">catch</span>(Exception $e) {
        print <span class="stringliteral">&#39;&lt;p style=&quot;color:red&quot;&gt;</span>
<span class="stringliteral">        ERROR! &#39;</span> . $e-&gt;getMessage() . <span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;
}
</pre></div><p>Take into account that the recipients numbers must include the international country calling code.</p>
<p>The list of allowed mime types: </p>
<ul>
<li>
TEXT_PLAIN = 'text/plain'; </li>
<li>
IMAGE_JPEG = 'image/jpeg'; </li>
<li>
IMAGE_BMP = 'image/bmp'; </li>
<li>
IMAGE_GIF = 'image/gif'; </li>
<li>
IMAGE_PNG = 'image/png'; </li>
<li>
AUDIO_AMR = 'audio/amr'; </li>
<li>
AUDIO_MIDI = 'audio/midi'; </li>
<li>
AUDIO_MP3 = 'audio/mp3'; </li>
<li>
AUDIO_MPEG = 'audio/mpeg'; </li>
<li>
AUDIO_WAV = 'audio/wav'; </li>
<li>
VIDEO_MP4 = 'video/mp4'; </li>
<li>
VIDEO_3GPP = 'video/3gpp'; </li>
</ul>
<h3><a class="anchor" id="mmsmt_sending_notifications"></a>
Sending MMS with status notification</h3>
<p>It is possible to receive status notifications by providing BlueVia with an URI where notifications must be sent. This URI is provided during the MMS sending, including the optional parameters endpoint and correlator: </p>
<div class="fragment"><pre class="fragment"><span class="keywordflow">try</span> {
        $id = $mms-&gt;send(
        <span class="stringliteral">&quot;https://www.myendpoint.com&quot;</span>,
        $correlator
        );                                    
} <span class="keywordflow">catch</span>(Exception $e) {
        $this-&gt;fail($e-&gt;getMessage());
}
</pre></div><p> Note that although your are requesting delivery status notifications, you still are able to use the Location header to ask for delivery status following the polling strategy. Your application must reply with a 204 No Content HTTP status and no body.</p>
<h3><a class="anchor" id="mmsmt_checking_delivery_status_sec"></a>
Checking the delivery status</h3>
<p>After sending an MMS you may need to know if it has been delivered.</p>
<p>This alternative is used typically for mobile or desktop applications without a backend server. After sending a MMS, you need to keep the delivery status id to ask about the delivery status of that mms as follows: </p>
<div class="fragment"><pre class="fragment"><span class="comment">// Send MMS and keep the deliverystatus_id</span>
<span class="keywordflow">try</span> {   
    $deliverystatus_id= $mms-&gt;send();
} <span class="keywordflow">catch</span>(Exception $e) {
    print <span class="stringliteral">&#39;&lt;p style=&quot;color:red&quot;&gt; ERROR! &#39;</span> . $e-&gt;getMessage() . <span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;
}
<span class="comment">// Receive MMS status</span>
<span class="keywordflow">try</span> {
    $statuses = $mms-&gt;getDeliveryStatus($deliverystatus_id);
} <span class="keywordflow">catch</span>(Exception $e){
    print <span class="stringliteral">&#39;&lt;p style=&quot;color:red&quot;&gt; </span>
<span class="stringliteral">        ERROR on getDeliveryStatus! &#39;</span> . $e-&gt;getMessage() . <span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;
}

<span class="keywordflow">if</span> (!empty($statuses)) {
        print <span class="stringliteral">&#39;&lt;p style=&quot;color:green&quot;&gt;</span>
<span class="stringliteral">        SUCCESS on getDeliveryStatus! &#39;</span> . print_r($statuses, 1) . <span class="stringliteral">&#39;&lt;/p&gt;&#39;</span>;
}
</pre></div><h2><a class="anchor" id="mmsmo"></a>
MmsMO (Mobile Originated)</h2>
<h3><a class="anchor" id="mmsmo_client_set_up"></a>
Client set up</h3>
<p>In this case, only <b>two legged oauth</b> is needed and so you have to set up your BlueVia Client object as follows</p>
<p>As detailed in the programming guidelines, you have to set up the <a class="el" href="class_bluevia_client.html">BlueviaClient</a> object:</p>
<div class="fragment"><pre class="fragment">application_context = array(
    <span class="stringliteral">&#39;user&#39;</span> =&gt; array(
        <span class="stringliteral">&#39;token_access&#39;</span> =&gt; $token,
        <span class="stringliteral">&#39;token_secret&#39;</span> =&gt; $token_secret,
    )
);

$bv = <span class="keyword">new</span> <a class="code" href="class_bluevia_client.html">BlueviaClient</a>($mode,$application_context);
</pre></div><p> Once configured, you are able to get your MmsMO API client: </p>
<div class="fragment"><pre class="fragment"><span class="comment">// Get MMS API client</span>
$mms = $bv -&gt; getService(<span class="stringliteral">&#39;MmsMO&#39;</span>);
</pre></div><p>Your application can receive MMS from users sent to BlueVia shortcodes including your application keyword, you can grab user's messages.</p>
<p>There are two ways of receiving MMS sent to your application: </p>
<h3><a class="anchor" id="mms_polling_subsec"></a>
Polling to receive MMS</h3>
<p>After set up your client, your are ready to get the messages.</p>
<p>You can check the shortcodes available at <a href="https://bluevia.com/en/knowledge/APIs.API-country-availability">API country availability</a>.</p>
<p>The operation to get received messages has to be done in two steps. First you have to use the getMessages function to retreive the messages info, including a message identifier. Depending on the second parameter value (useAttachmentURL), the second step would be done in two different ways. If the parameter is true, ids of the attachments will be retreived in order to use the getAttachment operation; otherwise the attachments would have to be obtained throught the get_message function. </p>
<div class="fragment"><pre class="fragment">$shortcode =<span class="stringliteral">&quot;5210666&quot;</span>
<span class="comment">// Polling to receive MMS</span>
$receivedMessages = $mms -&gt;getMessages($shortcode, <span class="keyword">true</span>);
</pre></div><p> You can study the getMessages response at <a href="https://bluevia.com/en/knowledge/APIs.API-Guides.MMS#ReceivingMMSPolling">Received MMS </a> Once you have collected the list of MMS, message identifier and attachment identifier (in case you select it) are provided. You can get more information as follows. </p>
<ul>
<li>
<b>Using getAttachment</b>:Individual attachments are reached <div class="fragment"><pre class="fragment"> $attachment=$mms -&gt; getAttachment ($shortcode, 
                        $message_id, 
                        $attachment_id)
</pre></div> </li>
<li>
<b>Using getMessage</b>: All message attachments are retrieved <div class="fragment"><pre class="fragment"> $received_message = $mms -&gt; getMessage ($shortcode, 
                        $message_id)
</pre></div> The $received_message returning value would be an instance of the <a class="el" href="class_bluevia_client___received___m_m_s.html">BlueviaClient_Received_MMS</a> class containing the received MMS as an stdClass object and an array of attachments with <a class="el" href="class_bluevia_client___mime_content.html">BlueviaClient_MimeContent</a> type. </li>
</ul>
<p>Please note that this is just an example and you should implement an efficient polling strategy.</p>
<h3><a class="anchor" id="mmsmo_notifications_sec"></a>
Notifications</h3>
<p>Your application can create a subscription to receive MMS sent to your application. You can also unsubscribe the notification for this request</p>
<p>To receive notifications about MMS sent to your applications you must provide an endpoint whit the URI where notifications must be sent and a correlator element with and identifier to correlate notifications with subscriptions </p>
<div class="fragment"><pre class="fragment">$correlator = <span class="stringliteral">&quot;corr&quot;</span>.  rand(0, 1000);
</pre></div><p> Note that BlueVia only accepts HTTPS endpoints and the server certificate must be provided during the process of requesting the API key</p>
<p>You must also provide the list with the destination addresses and shortcode numbers </p>
<div class="fragment"><pre class="fragment"><span class="comment">// Setup the destination number</span>
$number = <span class="stringliteral">&quot;527902135544&quot;</span>;

<span class="comment">// Set the recipient with number</span>
$mms-&gt;setRecipient($number)
    -&gt;setMessage(MMS_SPECIAL_KEYWORD . <span class="stringliteral">&#39; Test mms&#39;</span>);
</pre></div><p>Then you can provide the criteria element containing the keyword you chose for your application when you requested the API key (keywords are case-insensitive) </p>
<div class="fragment"><pre class="fragment"><span class="comment">// Define the criteria value</span>
define(<span class="stringliteral">&#39;MMS_SPECIAL_KEYWORD&#39;</span>, <span class="stringliteral">&quot;MYKEYWORD&quot;</span>);
</pre></div><p> Finally, you can subscribe to receive the notifications that you configured </p>
<div class="fragment"><pre class="fragment"><span class="comment">// Start notifications</span>
$notif_id =  $mms-&gt;startMmsNotification(
                    <span class="stringliteral">&#39;https://www.myendpoint.com/&#39;</span>,
                    $correlator,
                    MMS_SPECIAL_KEYWORD);
</pre></div><p> If you want to unsubscribe and stop reveiving notifications you should simply do: </p>
<div class="fragment"><pre class="fragment"><span class="comment">// Stop notifications</span>
$mms-&gt;stopMmsNotification($notif_id);
</pre></div> </div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">Generated on Mon Jan 23 2012 13:31:21 for Bluevia by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
