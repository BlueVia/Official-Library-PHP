<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Bluevia: OAuth API guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Bluevia&#160;<span id="projectnumber">1.5</span></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('blv_php_oauth_guide.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>OAuth API guide </h1>  </div>
</div>
<div class="contents">
<div class="textblock"><p>BlueVia APIs require authentication for applications to get information and send data. Normally, an application is acting on behalf of a final user, so both the user and your application must be identified and authenticated. You can get full information about it at <a href="https://bluevia.com/en/knowledge/getStarted.Authentication">Bluevia OAuth guide</a></p>
<h2><a class="anchor" id="req_token"></a>
Get your request token</h2>
<p>Most of requests when accessing Bluevia API are associated to a specific user, so when a <a class="el" href="class_bluevia_client.html">BlueviaClient</a> object is created both user token and user token secret must be provided to identify user on behalf of whom the application wants to access BlueVia APIs. To get the users authorization for using BlueVia API's on their behalf, you shall do as follows. By using your API key, you have to create a request token that is required to start the OAuth process. For example:</p>
<p>As detailed in the Programming guidelines you have to set up your <a class="el" href="class_bluevia_client.html">BlueviaClient</a> object:</p>
<div class="fragment"><pre class="fragment">$application_context = array(
    <span class="stringliteral">&#39;app&#39;</span> =&gt; array(
        <span class="stringliteral">&#39;consumer_key&#39;</span> =&gt; CONSUMER_KEY,
        <span class="stringliteral">&#39;consumer_secret&#39;</span> =&gt; CONSUMER_SECRET        
    )
);
$bv = <span class="keyword">new</span> <a class="code" href="class_bluevia_client.html">BlueviaClient</a>($mode,$application_context);
</pre></div><p> Once configured, you are able to get your Oauth API client: </p>
<div class="fragment"><pre class="fragment">$oauth=$bv-&gt;getService(<span class="stringliteral">&#39;Oauth&#39;</span>);
<span class="keywordflow">try</span>{
        $request_token = $oauth-&gt;getRequestToken($callBackUrl);
}
<span class="keywordflow">catch</span>(Exception $e){
        print <span class="stringliteral">&quot;Exception: &quot;</span>.$e-&gt;getMessage();
}
</pre></div><p>Both token and token_secret must be saved in your application because oAuth process will require it later. To get user authorization using the oauth_token from your request token (only for <a href="#out_of_band">"OutOfBand"</a> and <a href="#web_oauth">"WebOauth"</a> modes), you have to take the user to BlueVia Connect including your oauth_token as a request parameter. For example: </p>
<div class="fragment"><pre class="fragment">https:<span class="comment">//connect.bluevia.com/authorise?oauth_token=20101022141902000172</span>
</pre></div><p> User must be redirected to BlueVia Connect in order to confirm his identity and to authorize your application's special conditions. After that, a PIN code is received. Note that callback is an important parameter and according to it, authorization progress shall be done in one of the three ways explained below. <a class="anchor" id="out_of_band"></a> </p>
<h3><a class="anchor" id="out_of_band"></a>
OutOfBand authorization</h3>
<p>Callback parameter it's not defined (as shown below). In this case the library will set the callback parameter to "oob". You have to ask the user to enter the PIN code (oauth_verifier) in your app. Note that your users will need to copy and paste the PIN code manually, so be clear when you request it to be sure they do not get confused. </p>
<div class="fragment"><pre class="fragment">$request_token = $oauth-&gt;getRequestToken();
</pre></div><p> <a class="anchor" id="web_oauth"></a> </p>
<h3><a class="anchor" id="web_oauth"></a>
WebOauth authorization</h3>
<p>Callback parameter is a defined callback URL. You will receive the oauth_verifier as a request parameter at your callback. </p>
<div class="fragment"><pre class="fragment">$request_token = $oauth-&gt;getRequestToken(<span class="stringliteral">&quot;http://foo.bar/bluevia/get_access&quot;</span>)
</pre></div> <h3><a class="anchor" id="sms_oauth"></a>
SMSOauth authorization</h3>
<p>Finally Bluevia supports a variation of OAuth process where the user is not using the browser to authorize the application. Instead he will receive an SMS containing he PIN code (oauth_verifier). To use this SMS handshake, getRequestToken request must pass the user's MSISDN (phone number) in callback parameter. After the user had received the PIN code, the application should allow him to enter it and request the access token. </p>
<div class="fragment"><pre class="fragment">$request_token = $oauth-&gt;getRequestToken(<span class="stringliteral">&quot;34609090909&quot;</span>)
</pre></div> <h2><a class="anchor" id="access_token"></a>
Obtain the access token</h2>
<p>With the obtained PIN code (oauth_verifier), you can now get the accessToken from the user as follows: </p>
<div class="fragment"><pre class="fragment"><span class="keywordflow">try</span> {
        <span class="comment">// Note that in this case, the request token would be taken from the cookie </span>
        <span class="comment">// that has previously stored by the library.</span>
        $access_token = $oauth-&gt;getAccessToken($oauth_verifier);
        <span class="keywordflow">if</span>($access_token) var_dump($access_token);
} <span class="keywordflow">catch</span> (Exception $e) {
        print <span class="stringliteral">&quot;Exception: &quot;</span>.$e-&gt;getMessage();
</pre></div><p> You can obtain the oauth_verifier from the request from BlueVia to your callback URL: </p>
<div class="fragment"><pre class="fragment">$oauth_verifier = $_GET[<span class="stringliteral">&#39;oauth_verifier&#39;</span>];
</pre></div><p> The following example will show how to obtain the access token providing the verification code and the request token parameters.</p>
<div class="fragment"><pre class="fragment">$request_token = <span class="keyword">new</span> Zend_Oauth_Token_Request();
$request_token-&gt;setParams(array(
                        <span class="stringliteral">&#39;oauth_callback_confirmed&#39;</span> =&gt; <span class="stringliteral">&#39;true&#39;</span>,
                        <span class="stringliteral">&#39;oauth_token_secret&#39;</span> =&gt; <span class="stringliteral">&#39;xxxxxxxxxxxxxxxx&#39;</span>,
                        <span class="stringliteral">&#39;oauth_token&#39;</span> =&gt; <span class="stringliteral">&#39;xxxxxxxxxxxxxxxxx&#39;</span>));
<span class="keywordflow">try</span>{
        $access_token = $oauth-&gt;getAccessToken($oauth_verifier,$request_token);
        <span class="keywordflow">if</span>($access_token) var_dump($access_token);
} <span class="keywordflow">catch</span> (Exception $e) {
        print <span class="stringliteral">&quot;Exception: &quot;</span>.$e-&gt;getMessage();
}
</pre></div> <h2><a class="anchor" id="oauth_making_authorized_request_sec"></a>
Making an authorized API request</h2>
<p>Once your have obtained the user access token, you will be ready to use it on the Unica object that will be your BlueVia API's client.</p>
<p>To associate the access token and include the Authorization header for that user you have to do the following: </p>
<div class="fragment"><pre class="fragment">$application_context = array(
    <span class="stringliteral">&#39;user&#39;</span> =&gt; array(
        <span class="stringliteral">&#39;token_access&#39;</span> =&gt; $token,
        <span class="stringliteral">&#39;token_secret&#39;</span> =&gt; $token_secret,
    ),
    <span class="stringliteral">&#39;app&#39;</span> =&gt; array(
        <span class="stringliteral">&#39;consumer_key&#39;</span> =&gt; CONSUMER_KEY,
        <span class="stringliteral">&#39;consumer_secret&#39;</span> =&gt; CONSUMER_SECRET        
    )
);
$bv = <span class="keyword">new</span> <a class="code" href="class_bluevia_client.html">BlueviaClient</a>($mode,$application_context);
</pre></div><p>When you make an authorized API request the following exceptions may be thrown: </p>
<ul>
<li>
<b><a class="el" href="class_bluevia_client___exception___parameters.html">BlueviaClient_Exception_Parameters</a></b>: thrown when some expected parameters are missing. </li>
<li>
<b><a class="el" href="class_bluevia_client___exception___response.html">BlueviaClient_Exception_Response</a></b>: thrown when response has an error. </li>
<li>
<b><a class="el" href="class_bluevia_client___exception___client.html">BlueviaClient_Exception_Client</a></b>: thrown when a generic client error ocurres. </li>
<li>
<b><a class="el" href="class_bluevia_client___exception___server.html">BlueviaClient_Exception_Server</a></b>: thrown when the server returns an error </li>
</ul>
</div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="footer">Generated on Mon Jan 23 2012 13:31:21 for Bluevia by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
